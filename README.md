# 炼金助手 (Alchemist's Assistant)

[![版本](https://img.shields.io/badge/版本-4.0.0-blue.svg)](https://github.com/user/AlchAss)
[![游戏版本](https://img.shields.io/badge/游戏版本-Potion%20Craft-green.svg)](https://store.steampowered.com/app/1210320/Potion_Craft_Alchemist_Simulator/)
[![平台](https://img.shields.io/badge/平台-BepInEx-orange.svg)](https://github.com/BepInEx/BepInEx)

> 🧪 一个功能强大的《药剂工艺》游戏辅助工具，为炼金师提供精确的数据分析和便捷的操作控制！

## 📖 简介

炼金助手是专为《药剂工艺（Potion Craft: Alchemist Simulator）》设计的综合性辅助mod。它通过实时数据分析、精确操作控制、可视化辅助线和智能自动化功能，帮助玩家深入理解游戏机制，提升炼药效率和精确度。如果您有任何建议或意见，欢迎联系我。

[Nexus链接](https://www.nexusmods.com/potioncraftalchemistsimulator/mods/47)

## ✨ 核心功能详解

### 📊 信息窗口系统

#### 🔬 研磨信息窗口
- **实时研磨进度**：以百分比显示当前药材的研磨完成度
- **智能检测**：自动识别研杵中的药材并显示状态
- **精确数值**：提供准确到小数点的研磨度数据

#### ❤️ 血量信息窗口
- **当前血量**：显示药剂的生命值百分比
- **实时更新**：随着炼制过程动态变化

#### 🌪️ 漩涡信息窗口
当药水瓶接触漩涡时提供详细的几何数据：
- **当前距离**：药水瓶到漩涡中心的精确距离
- **最大距离**：可以安全接触漩涡的最大距离
- **当前夹角**：加水方向与漩涡方向的夹角
- **最大夹角**：可以进行外拉操作的最大角度限制
- **安全区域计算**：基于漩涡半径和药水瓶半径的精确计算

#### 📍 位置信息窗口
提供药水瓶在地图上的精确定位：
- **直角坐标模式**：显示X、Y坐标值
- **极坐标模式**：显示距离(r)和角度(θ)
- **旋转盐量**：当前的盐值旋转量，支持日盐🌞和月盐🌙图标显示
- **坐标系切换**：按空格键在两种坐标系间切换

#### 🥄 移动信息窗口
详细显示搅拌和加水的状态：
- **搅拌阶段**：当前处于第几段搅拌路径
- **阶段进度**：当前段落的完成进度
- **搅拌方向**：当前搅拌的角度方向
- **加水方向**：当前加水操作的角度方向

#### 🗺️ 区域信息窗口
记录和显示重要区域的位置信息：
- **四种区域类型**：沼泽、骷髅(强危险)、碎骨(弱危险)、回复区域
- **位置记录**：自动记录进入各区域时的精确坐标
- **搅拌状态记录**：记录进入时的搅拌阶段和进度
- **区域切换**：按句号(.)键循环查看不同区域的记录
- **坐标显示**：支持直角坐标和极坐标两种显示模式

#### 🎯 目标信息窗口
当鼠标悬停在药剂效果上时显示：
- **效果名称**：显示目标效果的本地化名称
- **目标位置**：目标效果在地图上的精确坐标
- **目标旋转**：到达该效果所需的盐值旋转量
- **目标方向**：从当前位置到目标的方向角度

#### 📏 偏离信息窗口
基于目标信息计算偏差数据：
- **总体偏离**：位置偏离和旋转偏离的综合评分
- **位置偏离**：当前位置与目标位置的距离偏差
- **旋转偏离**：当前旋转与目标旋转的角度偏差
- **精度等级**：L0-L3的精度等级评定，对应游戏中的无法炼制(L0)和1-3级药剂(L1-L3)
- **实时计算**：随着药水瓶移动实时更新偏差值

#### 🛤️ 路径信息窗口
分析搅拌路径与目标的关系：
- **路径偏差**：搅拌路径上最近点与目标的偏差
- **最近点方向**：路径最近点相对于目标的方向
- **路径夹角**：当前搅拌方向与目标方向的夹角
- **模式切换**：按反斜杠(\)键在"最近点模式"和"末端距离模式"间切换
- **智能计算**：自动分析整条搅拌路径找出最优接近点

#### 💧 加水信息窗口
分析加水路径与目标的关系：
- **加水偏差**：从当前位置向原点加水时与目标的最小偏差
- **最近点计算**：加水路径上距离目标最近的点
- **加水夹角**：当前加水方向与目标方向的夹角

#### ⌨️ 键位表窗口
显示所有mod快捷键和操作方法：
- **减速/批量操作**：Z/X键的不同减速档位和批量炼药功能
- **定量/目标操作**：右键精确设置数值和设定目标效果
- **辅助功能**：各种辅助线和模式切换
- **最近点制动**：]键的最近点制动功能
- **接近点制动**：[键的接近点制动功能
- **中英文对照**：支持中英文键位说明

### 🎮 精确操作控制

> ⚠️ 注意：以下功能已移至子模组 **Alchemist's Assistant Extension**，需要单独安装。

#### 🔥 定量加热控制
- **操作方法**：右键点击风箱把手
- **功能效果**：直接将药剂热量设置为配置文件中指定的数值
- **配置参数**：`HeatValue` (0-100)，默认100%

#### ⚖️ 定量研磨控制
- **操作方法**：右键点击研杵把手
- **功能效果**：直接将药材研磨度设置为指定值
- **配置参数**：`GrindValue` (0-100)，默认100%
- **智能检测**：仅在研杵中有药材时生效

#### 🤖 智能控制系统
一套完整的自动减速控制系统，使用统一的数学算法和配置参数：

**🌪️ 漩涡制动控制**：
- **启动方式**：按单引号(')键开启/关闭
- **工作原理**：当药水瓶接近漩涡边缘时自动减速搅拌和加水操作，防止意外脱离

**📍 最近点制动控制**：
- **启动方式**：按右方括号(])键开启/关闭
- **工作原理**：
  - 加水接近目标时：自动减速加水操作
  - 路径接近目标时：自动减速搅拌操作

**🎯 接近点制动控制**：
- **启动方式**：按左方括号([)键开启/关闭
- **工作原理**：
  - 加水接近目标时：自动减速搅拌操作
  - 路径接近目标时：自动减速加水操作
  - 任一接近目标时：自动减速加热操作

#### ⏬ 多档位减速控制
支持研磨、搅拌、加水、加热四种操作的减速：
- **Z键减速**：第一档减速，默认10倍减速
- **X键减速**：第二档减速，默认100倍减速
- **操作方式**：按住对应按键执行相关操作即可自动减速
- **精确控制**：可以通过配置文件自定义减速倍数
- **多操作支持**：同一个减速键可以作用于不同类型的操作

#### 📦 批量炼药功能
- **触发条件**：在配方书界面按住Z或X键点击炼制按钮
- **Z键批量**：默认制作10倍数量
- **X键批量**：默认制作100倍数量
- **智能检查**：自动检测材料是否足够，不足时不会执行批量制作

### 🎨 可视化辅助系统

#### 📏 方向指示线
- **启动方式**：按斜杠(/)键开启/关闭
- **显示内容**：
  - 搅拌方向线：显示当前搅拌的方向
  - 加水方向线：显示当前加水的方向  
  - 目标方向线：显示到达目标效果的方向
- **颜色区分**：不同颜色的线条代表不同类型的方向
- **实时更新**：随着操作和目标变化实时更新显示

#### 🏷️ 智能位置标记系统
完整的地图标记系统，提供6种不同类型的位置标记：

**区域位置标记**：
- **自动标记**：进入沼泽、骷髅、碎骨、回复区域时自动在地图上标记位置
- **区域识别**：不同区域使用不同的颜色标记
- **坐标记录**：同时在区域信息窗口中记录精确的数值坐标
- **重置方式**：标记会持续显示直到存档重载

**最近点标记**：
- **智能计算**：实时计算并显示目标效果的最近接近点
- **重置方式**：标记会持续显示直到不存在目标效果

## 🚀 快速安装

1. **安装BepInEx**：下载并解压到游戏根目录，运行游戏一次
2. **安装mod**：将`AlchAss.dll`和`AlchAssEx.dll`放入`BepInEx/plugins/`文件夹
3. **启动游戏**：正常启动即可

## 🎯 快捷键一览

| 按键 | 功能 | 详细说明 |
|------|------|----------|
| `/` | 辅助示线开关 | 显示/隐藏搅拌、加水、目标方向线和位置标记 |
| `'` | 漩涡制动开关 | 开启后接近漩涡边缘时自动减速防止脱离 |
| `]` | 最近点制动开关 | 开启后接近目标最近点时自动减速到停止 |
| `[` | 接近点制动开关 | 开启后接近目标效果位置时自动减速相关操作 |
| `\` | 路径模式切换 | 在"最近点距离"和"末端距离"模式间切换 |
| `空格` | 坐标系切换 | 在直角坐标(x,y)和极坐标(r,θ)间切换 |
| `.` | 区域信息切换 | 循环显示沼泽→骷髅→碎骨→回复区域的记录信息 |
| `Z` | 减速/批量档位1 | 按住时将当前操作减速至1/10速度，在配方书界面批量制作10倍数量 |
| `X` | 减速/批量档位2 | 按住时将当前操作减速至1/100速度，在配方书界面批量制作100倍数量 |
| `右键` | 定量/目标操作 | 右键风箱设定热量，右键研杵设定研磨度，右键目标效果设定目标 |

## ⚙️ 配置文件详解

**配置文件类型**：本mod提供两种配置方式
- **BepInEx原生配置**：存储在`BepInEx/config/org.dtx.alchass.cfg`文件中，包含各功能模块的开关设置，需重启游戏生效
- **游戏内实时配置**：可在游戏运行时随时修改，立即生效

**双语配置支持**：所有配置文件注释和界面描述均提供中英文对照

### BepInEx原生配置
- 文件位置：`BepInEx/config/org.dtx.alchass.cfg`
- 主要内容：功能模块的开关设置（启用/禁用各种信息窗口和辅助功能）
- 生效方式：修改后需重启游戏生效

### 游戏内实时配置
mod会在`BepInEx/config/AlchAss/`文件夹中自动生成以下游戏内实时配置文件：

- `AlchAssWindowConfig.txt` - 窗口位置配置（可在游戏中拖动窗口后自动保存）

> ⚠️ 注意：以下配置参数已移至子模组 **Alchemist's Assistant Extension**，需要单独安装。

- `AlchAssFunctionsConfig.txt` - 功能参数配置（可在游戏中随时修改）

### 功能参数配置 (需安装 Alchemist's Assistant Extension)

#### 🔧 数值设定
- `HeatValue=100` - 右键风箱时设定的热量值 (0-100)
- `GrindValue=100` - 右键研杵时设定的研磨度 (0-100)

#### ⚡ 减速参数
- `SlowdownFactorZ=10` - Z键减速倍数，数值越大越慢
- `SlowdownFactorX=100` - X键减速倍数，数值越大越慢

#### 📦 批量制作
- `BrewingMultiplierZ=10` - Z键批量制作倍数
- `BrewingMultiplierX=100` - X键批量制作倍数

#### 🎮 统一控制系统
- `ControlAreaThreshold=0.05` - 控制区域半径，数值越大制动区域越大
- `ControlSlowdownStrength=1.35` - 控制减速强度，数值越大减速越剧烈
- `ControlAsymptoteFactor=0.0015` - 控制减速渐近因子，数值越大减速越平滑
